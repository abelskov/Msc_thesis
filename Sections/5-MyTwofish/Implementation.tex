\section{Reversible Twofish}
\subsection{Reference implementation}
Bruce Schneier, who is a co-author of the algorithm, has a Github repository \cite{Git2F} with two implementations of Twofish: A highly optimized one in C and another one in Python2.7.
I will be focusing on the Python implementation as it is more similar to the Hermes implementation in its structure as well as being easier to read.
Its around 250 lines of code, so not awfully large but not small either. The complexity of the code is low/medium and it is overall pretty straight forward if you know how the algorithm works.

TODO: Snak om lifting scheme + konkluder hvorvidt Hermes er passende som domænespecifikt krypteringssprog

\subsection{encrypt/decrypt}
\subsubsection{Python}
Lets look at the encrypt/decrypt definitions.
\lstinputlisting[label=app:Encrypt Python,caption=encrypt/decrypt in Python, language=Python,frame=single] {"Listings/encrypt.py"}
We see that the only difference between encrypt and decrypt is the order in which they do things.
Encrypt uses the words K[0]-K[3] for input whitening, calls F 16 times with roundnumber r = 0 to 16, and then performs output whitening with the words K[4]-K[7]. Decrypt does the same but in the other direction. 

The parameters for the functions are subkeys K and S as well as a plaintext/ciphertext.
They both call F with five arguments: input words R[0] and R[1], the round number r which is used to select which subkeys to use, and the subkeys K and S.

\subsubsection{Hermes}
My implementation is structurally similar to the Python version. Lets have a look:
\lstinputlisting[label=app:Encrypt Hermes,caption=encrypt in Hermes, language=Hermes,frame=single] {"Listings/encrypt.hms"}
Here we see the same structure; input whitening followed by 16 rounds of encryption followed by output whitening. It has the same logic (calling F and rotating/XOR'ing) as the Python implementation. TODO: It uses Bennetts method of passing along some placeholder variables that can store some intermediate values which we can use to reset the inplace updated variables later with uncall.

\subsection{Galois Field multiplication}
Lorem ipsum..
%TODO: Galois Field multiplication is interesting because

\subsubsection{Python}
\lstinputlisting[label=app:GaloisField Python,caption=Galois Field multiplication in Python, language=Python,frame=single] {"Listings/gfmult.py"}

\subsubsection{Hermes}
%TODO: Det her må ku gøres pænere med flags array
%TODO: Polymult bruger Bennet? Snak om B ikke må være 0. Burde aldrig ske siger michael.
%TODO: GFMult er som sådan en reversibel funktion siger michael og den optræder i RSA. Konkluder evt. noget med at det her er babysteps towards en RSA implementation?
\lstinputlisting[label=app:GaloisField Hermes,caption=Galois Field multiplication in Hermes, language=Hermes,frame=single] {"Listings/gfmult.hms"}
